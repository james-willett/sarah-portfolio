---
/**
 * Header - Floating pill navigation component
 *
 * Matches Sarah's Figma design:
 * - Centered floating pill navigation
 * - White/light background with subtle shadow
 * - border-radius: 100px (fully rounded)
 * - padding: 8px, gap: 8px
 * - Active state shows filled dark background
 * - Responsive mobile menu
 */

import { siteConfig } from '../../astro.config.mjs';

// Get current path for active link highlighting
const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 left-0 right-0 z-50 pt-6 px-4">
  <!-- Centered floating navigation pill -->
  <nav class="flex justify-center">
    <!--
      Navigation pill container
      Figma specs:
      - display: inline-flex
      - padding: 8px
      - gap: 8px
      - border-radius: 100px
      - box-shadow: 1px 1px 4px 0 rgba(0, 0, 0, 0.1)
      - background: white
      - Size: ~440px Ã— 58px
    -->
    <div
      class="inline-flex items-center p-2 gap-2 rounded-full bg-white shadow-nav"
    >
      <!-- Desktop Navigation - Using explicit colors from Figma (#3F3F3F) -->
      <div class="hidden md:flex items-center gap-2">
        {siteConfig.nav.map((item) => {
          const isActive = currentPath === item.href ||
                          (item.href !== '/' && currentPath.startsWith(item.href));
          return (
            <a
              href={item.href}
              class={`px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 ${
                isActive
                  ? 'bg-[#3F3F3F] !text-white'
                  : 'text-[#3F3F3F] hover:bg-gray-100'
              }`}
            >
              {item.label}
            </a>
          );
        })}
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        type="button"
        class="md:hidden p-2 text-[#3F3F3F] hover:bg-gray-100 rounded-full transition-colors"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <!-- Hamburger Icon -->
        <svg
          id="menu-icon-open"
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
        <!-- Close Icon (hidden by default) -->
        <svg
          id="menu-icon-close"
          class="w-5 h-5 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

    </div>
  </nav>

  <!-- Mobile Navigation Menu (dropdown below the pill) -->
  <div
    id="mobile-menu"
    class="md:hidden hidden mt-2 flex justify-center"
  >
    <div class="inline-flex flex-col p-3 gap-2 rounded-2xl bg-white shadow-nav">
      {siteConfig.nav.map((item) => {
        const isActive = currentPath === item.href ||
                        (item.href !== '/' && currentPath.startsWith(item.href));
        return (
          <a
            href={item.href}
            class={`px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 text-center ${
              isActive
                ? 'bg-[#3F3F3F] !text-white'
                : 'text-[#3F3F3F] hover:bg-gray-100'
            }`}
          >
            {item.label}
          </a>
        );
      })}
    </div>
  </div>
</header>

<!-- Spacer to push content below fixed header -->
<div class="h-24"></div>

<script>
  // Mobile menu toggle functionality
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIconOpen = document.getElementById('menu-icon-open');
  const menuIconClose = document.getElementById('menu-icon-close');

  if (mobileMenuButton && mobileMenu && menuIconOpen && menuIconClose) {
    mobileMenuButton.addEventListener('click', () => {
      const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';

      // Toggle menu visibility
      mobileMenu.classList.toggle('hidden');

      // Toggle icons
      menuIconOpen.classList.toggle('hidden');
      menuIconClose.classList.toggle('hidden');

      // Update aria-expanded
      mobileMenuButton.setAttribute('aria-expanded', String(!isExpanded));
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (event) => {
      const target = event.target as HTMLElement;
      if (!target.closest('header')) {
        mobileMenu.classList.add('hidden');
        menuIconOpen.classList.remove('hidden');
        menuIconClose.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
      }
    });

    // Close mobile menu when window is resized to desktop size
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768) {
        mobileMenu.classList.add('hidden');
        menuIconOpen.classList.remove('hidden');
        menuIconClose.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
      }
    });
  }
</script>

<style>
  /* Custom shadow for navigation pill - matches Figma: 1px 1px 4px 0 rgba(0, 0, 0, 0.1) */
  .shadow-nav {
    box-shadow: 1px 1px 4px 0 rgba(0, 0, 0, 0.1);
  }

  /* Subtle backdrop blur for the header area */
  header {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
</style>
