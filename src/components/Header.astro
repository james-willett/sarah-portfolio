---
/**
 * Header - Floating pill navigation with sliding indicator
 *
 * Uses Astro View Transitions to animate the active indicator
 * between pages for a smooth, app-like navigation experience.
 *
 * Matches Sarah's Figma design:
 * - Centered floating pill navigation
 * - White/light background with subtle shadow
 * - border-radius: 100px (fully rounded)
 * - padding: 8px, gap: 8px
 * - Active state shows filled dark background that slides between items
 */

import { siteConfig } from '../../astro.config.mjs';

// Get current path for active link highlighting
const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 left-0 right-0 z-50 pt-6 px-4">
  <!-- Centered floating navigation pill -->
  <nav class="flex justify-center">
    <!--
      Navigation pill container
      Figma specs:
      - display: inline-flex
      - padding: 8px
      - gap: 8px
      - border-radius: 100px
      - box-shadow: 1px 1px 4px 0 rgba(0, 0, 0, 0.1)
      - background: white
    -->
    <div
      class="nav-pill inline-flex items-center p-2 gap-2 rounded-full bg-white shadow-nav"
    >
      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-2">
        {siteConfig.nav.map((item, index) => {
          const isActive = currentPath === item.href ||
                          (item.href !== '/' && currentPath.startsWith(item.href));
          return (
            <a
              href={item.href}
              class="nav-item"
              data-active={isActive ? 'true' : 'false'}
            >
              {/* Text label - always on top */}
              <span class="nav-label">{item.label}</span>

              {/* Active indicator - only rendered for active item */}
              {/* This element has transition:name so it animates between pages */}
              {isActive && (
                <span
                  class="nav-indicator"
                  transition:name="nav-indicator"
                  aria-hidden="true"
                />
              )}
            </a>
          );
        })}
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        type="button"
        class="md:hidden p-2 text-[#3F3F3F] hover:bg-gray-100 rounded-full transition-colors"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <!-- Hamburger Icon -->
        <svg
          id="menu-icon-open"
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
        <!-- Close Icon (hidden by default) -->
        <svg
          id="menu-icon-close"
          class="w-5 h-5 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

    </div>
  </nav>

  <!-- Mobile Navigation Menu (dropdown below the pill) -->
  <div
    id="mobile-menu"
    class="md:hidden hidden mt-2 flex justify-center"
  >
    <div class="inline-flex flex-col p-3 gap-2 rounded-2xl bg-white shadow-nav">
      {siteConfig.nav.map((item) => {
        const isActive = currentPath === item.href ||
                        (item.href !== '/' && currentPath.startsWith(item.href));
        return (
          <a
            href={item.href}
            class={`px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-200 text-center ${
              isActive
                ? 'bg-[#3F3F3F] !text-white'
                : 'text-[#3F3F3F] hover:bg-gray-100'
            }`}
          >
            {item.label}
          </a>
        );
      })}
    </div>
  </div>
</header>

<!-- Spacer to push content below fixed header -->
<div class="h-24"></div>

<script>
  // Mobile menu toggle functionality
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIconOpen = document.getElementById('menu-icon-open');
  const menuIconClose = document.getElementById('menu-icon-close');

  if (mobileMenuButton && mobileMenu && menuIconOpen && menuIconClose) {
    mobileMenuButton.addEventListener('click', () => {
      const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';

      // Toggle menu visibility
      mobileMenu.classList.toggle('hidden');

      // Toggle icons
      menuIconOpen.classList.toggle('hidden');
      menuIconClose.classList.toggle('hidden');

      // Update aria-expanded
      mobileMenuButton.setAttribute('aria-expanded', String(!isExpanded));
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (event) => {
      const target = event.target as HTMLElement;
      if (!target.closest('header')) {
        mobileMenu.classList.add('hidden');
        menuIconOpen.classList.remove('hidden');
        menuIconClose.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
      }
    });

    // Close mobile menu when window is resized to desktop size
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768) {
        mobileMenu.classList.add('hidden');
        menuIconOpen.classList.remove('hidden');
        menuIconClose.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
      }
    });
  }
</script>

<style>
  /* Custom shadow for navigation pill - Figma: 1px 1px 4px 0 rgba(0, 0, 0, 0.25) */
  .shadow-nav {
    box-shadow: 1px 1px 4px 0 rgba(0, 0, 0, 0.25);
  }

  /* Subtle backdrop blur for the header area */
  header {
    backdrop-filter: blur(3px);
    -webkit-backdrop-filter: blur(3px);
  }

  /* Nav item uses CSS Grid to stack label and indicator */
  /* Figma specs: w-104px, p-16px, rounded-100px, font-20px, PP Radio Grotesk */
  .nav-item {
    display: grid;
    position: relative;
    width: 104px;
    padding: 16px;
    border-radius: 100px;
    font-family: "PP Radio Grotesk", system-ui, sans-serif;
    font-size: 20px;
    font-weight: 400;
    line-height: 1.3;
    color: #3F3F3F;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  /* Stack both children in the same grid cell */
  .nav-label,
  .nav-indicator {
    grid-area: 1 / 1;
  }

  /* Text label stays on top */
  .nav-label {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Active indicator slides behind the text */
  /* Figma: bg-#3F3F3F, border 1px solid #2B2B2B */
  .nav-indicator {
    z-index: 1;
    background-color: #3F3F3F;
    border: 1px solid #2B2B2B;
    border-radius: 100px;
    /* Expand to fill the nav-item padding area */
    margin: -16px;
    padding: 16px;
  }

  /* When indicator is present, text should be white */
  /* Figma: #FBFBFB */
  .nav-item[data-active="true"] .nav-label {
    color: #FBFBFB;
  }

  /* Hover effect for non-active items - Figma: text becomes #AAA */
  .nav-item[data-active="false"]:hover .nav-label {
    color: #AAAAAA;
  }

  /*
   * View Transition Animation Configuration
   * The indicator animates smoothly between pages using Astro's View Transitions
   */
  ::view-transition-old(nav-indicator),
  ::view-transition-new(nav-indicator) {
    /* Maintain the pill shape during animation */
    height: 100%;
    border-radius: 100px;
  }

  ::view-transition-group(nav-indicator) {
    /* Smooth easing for a natural feel */
    animation-duration: 0.25s;
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>
